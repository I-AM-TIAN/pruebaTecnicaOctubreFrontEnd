# ðŸŽ¤ Audio Prescription - FAQ (Preguntas Frecuentes)

## Para Usuarios (Doctores)

### General

**P: Â¿QuÃ© es la funcionalidad de prescripciÃ³n por audio?**  
R: Es una nueva caracterÃ­stica que permite a los doctores crear prescripciones mÃ©dicas grabando un audio en lugar de escribirlas manualmente. El sistema usa Inteligencia Artificial para transcribir el audio y extraer automÃ¡ticamente la informaciÃ³n de los medicamentos.

**P: Â¿CuÃ¡nto tiempo tarda en procesarse?**  
R: TÃ­picamente entre 10-30 segundos, dependiendo de la longitud del audio y la carga del servidor.

**P: Â¿Puedo ver la transcripciÃ³n del audio?**  
R: SÃ­, cuando ves el detalle de una prescripciÃ³n creada por audio, verÃ¡s una secciÃ³n especial que muestra la transcripciÃ³n completa.

---

### Requisitos

**P: Â¿QuÃ© navegadores son compatibles?**  
R: Chrome, Firefox, Safari, Edge y navegadores mÃ³viles (iOS/Android). Recomendamos Chrome para mejor experiencia.

**P: Â¿Necesito instalar algo especial?**  
R: No, solo necesitas un navegador actualizado y un micrÃ³fono funcional.

**P: Â¿Funciona en dispositivos mÃ³viles?**  
R: SÃ­, funciona en telÃ©fonos y tablets con micrÃ³fono.

**P: Â¿Necesito conexiÃ³n a internet?**  
R: SÃ­, se requiere conexiÃ³n estable para subir el audio y procesarlo.

---

### GrabaciÃ³n

**P: Â¿CuÃ¡nto tiempo puedo grabar?**  
R: Recomendamos 10-60 segundos. El lÃ­mite es de 10MB de archivo, que equivale a aproximadamente 10 minutos.

**P: Â¿Puedo pausar la grabaciÃ³n?**  
R: SÃ­, hay botones de pausar y reanudar durante la grabaciÃ³n.

**P: Â¿El navegador me pide permiso para usar el micrÃ³fono?**  
R: SÃ­, la primera vez que uses la funciÃ³n, debes permitir el acceso al micrÃ³fono.

**P: Â¿QuÃ© hago si niego el permiso del micrÃ³fono?**  
R: Puedes usar la opciÃ³n de subir un archivo de audio en su lugar, o cambiar los permisos en la configuraciÃ³n de tu navegador.

**P: Â¿Puedo escuchar el audio antes de enviarlo?**  
R: SÃ­, despuÃ©s de grabar verÃ¡s un reproductor de audio para verificar la grabaciÃ³n.

---

### Archivos de Audio

**P: Â¿QuÃ© formatos de audio acepta?**  
R: MP3, WAV, OGG, M4A y WEBM.

**P: Â¿CuÃ¡l es el tamaÃ±o mÃ¡ximo de archivo?**  
R: 10MB.

**P: Â¿Puedo subir un audio pregrabado?**  
R: SÃ­, usa el botÃ³n "Subir Audio" para seleccionar un archivo de tu dispositivo.

**P: Â¿Puedo editar el audio despuÃ©s de grabarlo?**  
R: No directamente en la aplicaciÃ³n. Si necesitas editar, graba de nuevo o edita externamente y sube el archivo.

---

### Calidad y Contenido

**P: Â¿QuÃ© debo decir en el audio?**  
R: Menciona claramente:
- Nombre del medicamento
- Dosis (ej: 400mg)
- Cantidad (ej: 20 tabletas)
- Instrucciones (ej: cada 8 horas)

**P: Â¿Importa cÃ³mo hable?**  
R: SÃ­, habla claro, despacio y pronuncia bien los nombres de los medicamentos.

**P: Â¿Puedo dictar varios medicamentos?**  
R: SÃ­, puedes incluir mÃºltiples medicamentos en un solo audio.

**P: Â¿QuÃ© pasa si hay ruido de fondo?**  
R: El ruido puede afectar la calidad de la transcripciÃ³n. Graba en un lugar silencioso.

**P: Â¿Puedo dictar en otro idioma?**  
R: Actualmente solo estÃ¡ optimizado para espaÃ±ol e inglÃ©s.

---

### Errores Comunes

**P: "Permiso denegado al micrÃ³fono" - Â¿QuÃ© hago?**  
R: Ve a la configuraciÃ³n de tu navegador y permite el acceso al micrÃ³fono para este sitio. O usa la opciÃ³n de subir archivo.

**P: "No se encontrÃ³ micrÃ³fono" - Â¿QuÃ© significa?**  
R: Tu dispositivo no tiene micrÃ³fono o no estÃ¡ conectado. Verifica tu hardware o usa la opciÃ³n de subir archivo.

**P: "El archivo es demasiado grande" - Â¿CÃ³mo lo arreglo?**  
R: Reduce la duraciÃ³n del audio o comprime el archivo antes de subirlo. MÃ¡ximo 10MB.

**P: "Paciente no encontrado" - Â¿Por quÃ© pasa esto?**  
R: Verifica que seleccionaste un paciente del dropdown antes de enviar.

**P: La transcripciÃ³n no es correcta - Â¿QuÃ© hago?**  
R: Si la IA malinterpreta el audio, puedes:
1. Eliminar la prescripciÃ³n incorrecta
2. Grabar de nuevo con mejor pronunciaciÃ³n
3. Usar el mÃ©todo manual de creaciÃ³n

---

### Seguridad y Privacidad

**P: Â¿Es seguro subir audios mÃ©dicos?**  
R: SÃ­, usamos HTTPS y autenticaciÃ³n JWT. Solo doctores autorizados pueden acceder.

**P: Â¿Se guardan los archivos de audio?**  
R: No, solo se guarda la transcripciÃ³n de texto. El audio se procesa y se descarta.

**P: Â¿QuiÃ©n puede ver las prescripciones creadas por audio?**  
R: Solo el doctor que las creÃ³, el paciente asignado y los administradores.

**P: Â¿Los audios viajan por internet?**  
R: SÃ­, se envÃ­an al servidor para procesamiento. Usa conexiÃ³n segura (HTTPS).

---

### Problemas TÃ©cnicos

**P: El botÃ³n "Crear PrescripciÃ³n" estÃ¡ deshabilitado - Â¿Por quÃ©?**  
R: Verifica que:
1. Seleccionaste un paciente
2. Tienes un audio grabado o subido
3. No estÃ¡s grabando actualmente

**P: El procesamiento tarda mucho - Â¿Es normal?**  
R: Puede tardar hasta 30 segundos. Si tarda mÃ¡s, puede haber un problema de conexiÃ³n.

**P: Â¿QuÃ© hago si falla el envÃ­o?**  
R: Verifica tu conexiÃ³n a internet e intenta de nuevo. Si persiste, contacta soporte.

**P: El audio no se reproduce despuÃ©s de grabar - Â¿QuÃ© hago?**  
R: Puede ser un problema del navegador. Intenta refrescar la pÃ¡gina y grabar de nuevo.

---

## Para Desarrolladores

### ImplementaciÃ³n

**P: Â¿CÃ³mo integro esta funcionalidad en mi proyecto?**  
R: Revisa `AUDIO_PRESCRIPTION_TECHNICAL.md` para documentaciÃ³n completa.

**P: Â¿QuÃ© APIs externas se usan?**  
R: 
- ElevenLabs API para transcripciÃ³n
- OpenAI API (GPT-4) para extracciÃ³n de datos

**P: Â¿CÃ³mo manejo los errores?**  
R: El hook `useAudioRecorder` y el servicio API tienen manejo de errores incorporado. Ver documentaciÃ³n tÃ©cnica.

**P: Â¿Puedo personalizar la UI?**  
R: SÃ­, todos los componentes usan TailwindCSS y son personalizables.

---

### MediaRecorder API

**P: Â¿QuÃ© navegadores soportan MediaRecorder?**  
R: Chrome 47+, Firefox 25+, Safari 14+, Edge (Chromium).

**P: Â¿QuÃ© formato graba por defecto?**  
R: WEBM en Chrome/Firefox, MP4 en Safari.

**P: Â¿CÃ³mo cambio la calidad de audio?**  
R: Puedes modificar las opciones en `useAudioRecorder.ts`:
```typescript
sampleRate: 44100, // Calidad CD
```

**P: Â¿Puedo agregar visualizaciÃ³n de onda?**  
R: SÃ­, pero requiere implementaciÃ³n adicional con Web Audio API.

---

### Backend

**P: Â¿QuÃ© endpoints se necesitan?**  
R: `POST /prescriptions/from-audio` con FormData (audio + patientId).

**P: Â¿CÃ³mo valido el audio en el backend?**  
R: Verifica:
- Tipo de archivo (MIME type)
- TamaÃ±o (mÃ¡x 10MB)
- Que sea un archivo de audio vÃ¡lido

**P: Â¿CÃ³mo proceso el audio?**  
R: 
1. Recibe FormData
2. EnvÃ­a audio a ElevenLabs para transcripciÃ³n
3. EnvÃ­a transcripciÃ³n a OpenAI para extracciÃ³n
4. Guarda en base de datos

**P: Â¿QuÃ© hago con errores de las APIs externas?**  
R: Maneja los errores y devuelve mensajes claros al frontend:
```json
{
  "statusCode": 500,
  "message": "Error al procesar el audio: ...",
  "error": "Internal Server Error"
}
```

---

### Costos

**P: Â¿CuÃ¡nto cuesta por prescripciÃ³n?**  
R: Aproximadamente $0.05 USD por prescripciÃ³n (transcripciÃ³n + extracciÃ³n).

**P: Â¿CÃ³mo reduzco costos?**  
R: 
- Limita la duraciÃ³n mÃ¡xima de audio
- Comprime archivos antes de procesar
- Implementa cachÃ© si es aplicable

**P: Â¿Hay lÃ­mites de uso?**  
R: Depende de tus planes de ElevenLabs y OpenAI. Verifica tus cuotas.

---

### Testing

**P: Â¿CÃ³mo pruebo sin micrÃ³fono?**  
R: Usa la opciÃ³n de subir archivo con audios de prueba pregrabados.

**P: Â¿Hay tests automatizados?**  
R: Actualmente no, pero se recomienda agregar tests para:
- Hook `useAudioRecorder`
- Servicio API
- Componente de pÃ¡gina

**P: Â¿CÃ³mo simulo errores?**  
R: Puedes:
- Desconectar internet (error de red)
- Subir archivo muy grande (error de tamaÃ±o)
- No seleccionar paciente (error de validaciÃ³n)

---

### Performance

**P: Â¿CÃ³mo mejoro el tiempo de procesamiento?**  
R: 
- Usa servidores mÃ¡s rÃ¡pidos
- Optimiza llamadas a APIs externas
- Implementa cachÃ© cuando sea posible

**P: Â¿Puedo comprimir el audio antes de subir?**  
R: SÃ­, puedes implementar compresiÃ³n en el frontend antes de enviar.

**P: Â¿Hay lÃ­mite de usuarios simultÃ¡neos?**  
R: Depende de tu infraestructura backend y cuotas de APIs externas.

---

### Extensiones Futuras

**P: Â¿Puedo agregar transcripciÃ³n en tiempo real?**  
R: SÃ­, pero requiere integraciÃ³n con APIs de streaming (ej: Deepgram).

**P: Â¿Puedo agregar mÃ¡s idiomas?**  
R: SÃ­, ajustando la configuraciÃ³n de ElevenLabs y OpenAI para otros idiomas.

**P: Â¿Puedo editar el audio en la app?**  
R: RequerirÃ­a implementar Web Audio API para ediciÃ³n bÃ¡sica.

**P: Â¿Puedo agregar comandos de voz?**  
R: SÃ­, con procesamiento adicional de lenguaje natural.

---

## Troubleshooting Avanzado

### Problema: Audio no se graba en Safari iOS

**SoluciÃ³n:**
- Verifica que el usuario dio permisos
- Safari requiere HTTPS en producciÃ³n
- Verifica que el formato MP4 estÃ© soportado

```typescript
const mimeType = 'audio/mp4'; // Para Safari
```

---

### Problema: FormData no llega al backend

**SoluciÃ³n:**
- Verifica CORS en el backend
- AsegÃºrate de no enviar `Content-Type` header manualmente
- Deja que el navegador lo configure automÃ¡ticamente

```typescript
// âŒ No hagas esto
headers: {
  'Content-Type': 'multipart/form-data',
}

// âœ… Hazlo asÃ­
headers: {
  'Authorization': `Bearer ${token}`,
  // No incluyas Content-Type
}
```

---

### Problema: TranscripciÃ³n con errores

**Causas:**
- Audio de baja calidad
- Ruido de fondo
- Mala pronunciaciÃ³n
- Audio cortado

**Soluciones:**
- Mejora calidad del micrÃ³fono
- Graba en lugar silencioso
- Habla mÃ¡s despacio y claro
- Incrementa sampleRate a 48000Hz

---

### Problema: Timeout al procesar

**Causas:**
- Audio muy largo
- APIs externas lentas
- ConexiÃ³n lenta

**Soluciones:**
- Incrementa timeout del fetch
- Limita duraciÃ³n mÃ¡xima de audio
- Implementa retry logic

```typescript
const controller = new AbortController();
const timeoutId = setTimeout(() => controller.abort(), 60000); // 60s

fetch(url, {
  signal: controller.signal,
  // ...
});
```

---

## Recursos Adicionales

### DocumentaciÃ³n
- ðŸ“– GuÃ­a de Usuario: `AUDIO_PRESCRIPTION_GUIDE.md`
- ðŸ”§ DocumentaciÃ³n TÃ©cnica: `AUDIO_PRESCRIPTION_TECHNICAL.md`
- ðŸŒŠ Diagrama de Flujo: `AUDIO_PRESCRIPTION_FLOW.md`
- ðŸ“‹ Resumen de ImplementaciÃ³n: `IMPLEMENTATION_SUMMARY.md`

### APIs Externas
- [ElevenLabs Docs](https://elevenlabs.io/docs)
- [OpenAI API Docs](https://platform.openai.com/docs)
- [MediaRecorder API](https://developer.mozilla.org/en-US/docs/Web/API/MediaRecorder)

### Soporte
- Reporta bugs en GitHub Issues
- Contacta al equipo de desarrollo
- Revisa logs del backend para errores de API

---

**Ãšltima actualizaciÃ³n**: Noviembre 2025  
**Â¿No encuentras tu pregunta?** Contacta al equipo de soporte.
